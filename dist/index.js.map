{"version":3,"file":"index.js","sources":["../src/index.js"],"sourcesContent":["/* eslint-disable */\r\n\r\nfunction query2obj (query) {\r\n  const queryArr = query.split('&').filter(x => x)\r\n  let res = null\r\n  try {\r\n    res = JSON.parse(\r\n      '{' +\r\n        queryArr\r\n          .map(x => {\r\n            const [key, value] = x.split('=')\r\n            return `\"${key}\":\"${value}\"`\r\n          })\r\n          .join(',\\n') +\r\n      '}'\r\n    )\r\n  } catch (err) {\r\n    res = {}\r\n  }\r\n  return res\r\n}\r\n\r\n// 校验用到的工具函数或工具对象\r\nconst comm = {\r\n  regex: {\r\n    count (countStr) {\r\n      if (countStr === '*') {\r\n        return '*'\r\n      } else {\r\n        return `{${countStr}}`\r\n      }\r\n    },\r\n    email: {\r\n      whiteLists: [\r\n        'qq.com',\r\n        '163.com',\r\n        'vip.163.com',\r\n        'sohu.com',\r\n        'sina.cn',\r\n        'sina.com',\r\n        'gmail.com',\r\n        'hotmail.com'\r\n      ]\r\n    },\r\n    number: {\r\n      areaLabelReflex: {\r\n        both: '-?',\r\n        neg: '-',\r\n        pos: ''\r\n      }\r\n    }\r\n  }\r\n}\r\n\r\n// 内置的校验器\r\nconst validatorNameReflex = {\r\n\r\n  /** social media */\r\n\r\n  // 用户名\r\n  username (options) {\r\n    options = Object.assign({ min: 4, max: 16 }, options)\r\n    return new RegExp(`^[a-zA-Z][a-zA-Z0-9_-]{${options.min - 1},${options.max - 1}}$`)\r\n  },\r\n  // 中文用户名\r\n  username_cn (options) {\r\n    options = Object.assign({ min: 2, max: 8 }, options)\r\n    return new RegExp(`^[a-zA-Z\\\\u4E00-\\\\u9FA5][a-zA-Z0-9\\\\u4E00-\\\\u9FA5_-]{${options.min - 1},${options.max - 1}}$`)\r\n  },\r\n  // 邮箱\r\n  email () {\r\n    return new RegExp(`^([A-Za-z0-9_\\\\-\\\\.])+\\\\@([A-Za-z0-9_\\\\-\\\\.])+\\\\.([A-Za-z]{2,6})$`)\r\n  },\r\n  // 常用邮箱\r\n  email_general () {\r\n    return new RegExp(`^([A-Za-z0-9_\\\\-\\\\.])+\\\\@(${comm.regex.email.whiteLists.join('|')})$`)\r\n  },\r\n  // 手机号码\r\n  mobile: /^((13[0-9])|(14[5|7])|(15([0-3]|[5-9]))|(18[0,5-9]))\\d{8}$/,\r\n  // 身份证\r\n  idcard: /^[1-9]\\d{5}(18|19|([23]\\d))\\d{2}((0[1-9])|(10|11|12))(([0-2][1-9])|10|20|30|31)\\d{3}[0-9Xx]$/,\r\n  // URL\r\n  url: options => /^((https?|ftp|file):\\/\\/)?([\\da-z.-]+)\\.([a-z.]{2,6})([/\\w.-]*)*\\/?$/.test(options.value) || '不是正确的URL',\r\n\r\n  /** number */\r\n\r\n  // 整数\r\n  interger (options) {\r\n    options = Object.assign({ area: 'both' }, options)\r\n    return new RegExp(`^${comm.regex.number.areaLabelReflex[options.area]}\\\\d+$`) \r\n  },\r\n  // 浮点数\r\n  float (options) {\r\n    options = Object.assign({ area: 'both', count: '*' }, options)\r\n    return new RegExp(`^${comm.regex.number.areaLabelReflex[options.area]}\\\\d*\\\\.\\\\d${comm.regex.count(options.count)}$`)\r\n  },\r\n  // 数字\r\n  number: 'interger||float',\r\n  // 数字比较\r\n  max (options) {\r\n    options = Object.assign({ max: Number.MAX_SAFE_INTEGER }, options)\r\n    return !Number.isNaN(+options.value) && (+options.value < +options.max) || `应不大于${options.max }`\r\n  },\r\n  min (options) {\r\n    options = Object.assign({ min: Number.MIN_SAFE_INTEGER }, options)\r\n    return !Number.isNaN(+options.value) && (+options.value > +options.min) || `应不小于${options.min}`\r\n  },\r\n\r\n  /** general */\r\n\r\n  // 必需值\r\n  required: options => (!['null', 'undefined'].includes(options.value) && /.+/.test(options.value) || '值缺失'),\r\n}\r\n\r\n/** Valy\r\n * @description Valy校验器, 可以使用两种方式调用:\r\n *  1. new Valy('a1111', 'username').result\r\n *  2. new Valy('a1111').valid(['username', _ => _.length === 5]).check()\r\n * @param {Any} rawValue 待校验的值\r\n * @param {Array, Regex, Function} validItems 待校验的选项\r\n */\r\nexport default class Valy {\r\n  constructor ({ rawValue, rawValidItems } = { rawValue: undefined }) {\r\n    const argLen = arguments.length\r\n    const arg1 = arguments[0]\r\n    const arg2 = arguments[1]\r\n    // console.log('@@@@@@@@@@@@', argLen, arg1, arg2, this)\r\n    if (arg1 instanceof Object && !(arg1 instanceof Array)) {\r\n      Object.assign(this, {\r\n        pass: false,\r\n        result: null,\r\n        rawValue,\r\n        rawValidItems\r\n      })\r\n      this.exec()\r\n    } else if (argLen === 2) {\r\n      Object.assign(this, {\r\n        pass: false,\r\n        result: null,\r\n        rawValue: arg1,\r\n        rawValidItems: arg2\r\n      })\r\n      this.exec()\r\n    } else {\r\n      Object.assign(this, {\r\n        pass: false,\r\n        result: null,\r\n        rawValue: arg1,\r\n        rawValidItems\r\n      })\r\n    }\r\n    this.errorMsg = null\r\n    // console.log('@@@@@@@@@@@@', argLen, arg1, arg2, this)\r\n  }\r\n\r\n  toValid (validItems, options = { stragedy: 'and' }) {\r\n    let toValidResult = 'unexcepted valid result'\r\n    validItems = validItems == null ? this.rawValidItems : validItems\r\n    // console.log('@@@ : ', typeof validItems, validItems)\r\n\r\n    switch (typeof validItems) {\r\n      case 'function':\r\n        // console.log('valid items type : function : ', this)\r\n        const fnResult = validItems(this.rawValue)\r\n        // console.log('@@', fnResult)\r\n        if (['function', 'object'].includes(typeof fnResult)) {\r\n          toValidResult = this.toValid(fnResult)\r\n        } else {\r\n          toValidResult = fnResult\r\n        }\r\n        break\r\n\r\n      case 'object':\r\n        // console.log('valid items type : object')\r\n        if (Array.isArray(validItems)) {\r\n          const toValidResultArr = validItems.map(x => this.toValid(x))\r\n          // console.log('@@ : ', toValidResultArr)\r\n          switch (options.stragedy) {\r\n            case 'and':\r\n              toValidResult = toValidResultArr.every(x => x === true)\r\n              break\r\n            case 'or':\r\n              toValidResult = toValidResultArr.some(x => x === true)\r\n              break\r\n          }\r\n        } else if (validItems instanceof RegExp) {\r\n          toValidResult = validItems.test(this.rawValue)\r\n        } else {\r\n          throw new Error(`unsupported object type validItem : ${validItems}`)\r\n        }\r\n        break\r\n\r\n      case 'string':\r\n        // console.log('valid items type : string')\r\n        const validArr = validItems.split('||')\r\n        if (validArr.length > 1) {\r\n          toValidResult = this.toValid(validArr, Object.assign(options, { stragedy: 'or' }))\r\n        } else {\r\n          const toFindHandle = validItems.split('?')\r\n          const handle = validatorNameReflex[toFindHandle[0]]\r\n          if (!handle) {\r\n            toValidResult = false\r\n            this.errorMsg = validItems\r\n            break\r\n          }\r\n          if (typeof handle === 'function') {\r\n            const params = query2obj(`value=${this.rawValue}&` + (toFindHandle[1] || ''))\r\n            const handleFnRes = handle(params)\r\n            // console.log('@@--1: ', handleFnRes)\r\n            toValidResult = this.toValid(handleFnRes)\r\n          } else {\r\n            toValidResult = this.toValid(handle)\r\n          }\r\n        }\r\n        break\r\n\r\n      case 'boolean':\r\n        toValidResult = validItems\r\n        break\r\n\r\n      case 'undefined':\r\n        toValidResult = false\r\n        break\r\n\r\n      default:\r\n        console.log(typeof this.validItems, this.validItems, `unsupported type of validItem`)\r\n        throw new Error(`unsupported type of validItem : ${validItems}`)\r\n    }\r\n\r\n    return toValidResult\r\n  }\r\n\r\n  // 主动调用校验\r\n  valid (validItems) {\r\n    if (this.pass) return this\r\n    if (!(this.result = this.toValid(validItems))) {\r\n      this.pass = true\r\n    }\r\n    return this\r\n  }\r\n\r\n  // 对值进行格式化\r\n  format (fn = _ => _) {\r\n    this.rawValue = fn(this.rawValue)\r\n    return this\r\n  }\r\n\r\n  // 返回校验结果\r\n  exec () {\r\n    this.result = this.toValid()\r\n    // console.log(this.result)\r\n    return this.result\r\n  }\r\n\r\n  // 返回判断检验结果是否为某一特定的值\r\n  check (assertResult = true) {\r\n    return this.result === assertResult\r\n  }\r\n  not (assertResult = false) {\r\n    return this.result !== assertResult\r\n  }\r\n  getRes () {\r\n    return this.errorMsg || this.result\r\n  }\r\n}\r\n"],"names":["const","let","this"],"mappings":"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"}