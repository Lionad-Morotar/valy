{"version":3,"file":"index.js","sources":["../src/defaultValidator.js","../src/index.js"],"sourcesContent":["// import utils from './utils'\r\n\r\nexport default {\r\n\r\n  /** social media */\r\n\r\n  email: /^([A-Za-z0-9_.])+@([A-Za-z0-9_])+.([A-Za-z]{2,6})$/,\r\n  mobile: /^((13[0-9])|(14[5|7])|(15([0-3]|[5-9]))|(18[0,5-9]))\\d{8}$/,\r\n\r\n  /** number */\r\n\r\n  interger: /^-?\\d+$/,\r\n  float: /^-?\\d*.\\d*$/,\r\n  number: 'interger||float',\r\n  max (max) {\r\n    return ['notNaN', +this.value < max]\r\n  },\r\n  min (min) {\r\n    return ['notNaN', +this.value > min]\r\n  },\r\n\r\n  /** array */\r\n  \r\n  some (_) { \r\n    return this.value.some(x => this._valid(_, { value: x })) \r\n  },\r\n  every (_) { \r\n    return this.value.every(x => this._valid(_, { value: x })) \r\n  },\r\n\r\n  /** general */\r\n\r\n  required: /.+/,\r\n  is (_) { \r\n    return this.value === _ \r\n  },\r\n  not (_) { \r\n    return this.value !== _ \r\n  },\r\n  has (_) {\r\n    return this.value.includes(_)\r\n  }\r\n}","import defaultValidator from './defaultValidator.js'\r\n\r\n/**\r\n * Valy 链式调用的校验器 \r\n */\r\nclass Valy {\r\n\r\n  /** Constructor\r\n   * @param {Any} value 待校验的值\r\n   * @instance.value 校验的内容\r\n   * @instance.result 校验结果\r\n   * @instance.message 检验结果信息（比如，错误信息）\r\n   * @instance.pass 当一个数已经校验失败，则无需继续校验下去\r\n   */\r\n  constructor (value = '') {\r\n    if (!(this instanceof Valy)) return new Valy(value)\r\n\r\n    Object.assign(this, {\r\n      pass: false,\r\n      result: null,\r\n      message: '',\r\n      value\r\n    })\r\n\r\n    const insiderProps = Object.keys(this)\r\n      .concat(['_valid','format','valid','flush'])\r\n\r\n    return new Proxy(this, {\r\n      get: (target, prop, receiver) => {\r\n        if (insiderProps.includes(prop)) {\r\n          return Reflect.get(target, prop, receiver)\r\n        } else {\r\n          const handle = fns.find(x => x.has(prop))\r\n          const fn = handle.get(prop)\r\n          return params => {\r\n            this.valid(fn.bind ? fn.bind(this, params) : fn)\r\n            return receiver\r\n          } \r\n        }\r\n      }\r\n    })\r\n  }\r\n\r\n  /**\r\n   * 校验逻辑\r\n   * @param options.stragedy 当校验对象是数组时，默认使用 and（every）还是 some 逻辑\r\n   */\r\n  _valid (validators = [], options = { value: this.value }) {\r\n    options = Object.assign({ stragedy: 'and' }, options)\r\n    const value = options.value\r\n\r\n    /* 根据校验器的类型执行校验策略 */\r\n\r\n    const methods = {\r\n      Function () {\r\n        const fnRes = validators(value)\r\n        const type = typeof fnResult\r\n        return (type === 'function' || type === 'object')\r\n          ? this._valid(fnRes)\r\n          : fnRes\r\n      },\r\n      Array () {\r\n        const results = validators.map(x => this._valid(x))\r\n        return options.stragedy === 'and'\r\n          ? results.every(x => x === true)\r\n          : results.some(x => x === true)\r\n      },\r\n      RegExp () {\r\n        return validators.test(value)\r\n      },\r\n      Undefined () {\r\n        return false\r\n      },\r\n      // TODO: '1&&2||(2||3)'\r\n      String () {\r\n        let validResult = null\r\n        const validArr = validators.split('||')\r\n        if (validArr.length > 1) {\r\n          validResult = this._valid(validArr, Object.assign(options, { stragedy: 'or' }))\r\n        } else {\r\n          const toFindHandle = validators.split('?')\r\n          const [fnName, params] = [toFindHandle[0], (toFindHandle[1] || '').split(',')]\r\n          const handle = fns.find(x => x.has(fnName)).get(fnName)\r\n          if (!handle) {\r\n            validResult = false\r\n            this.message = validators\r\n            return validResult\r\n          }\r\n          if (typeof handle === 'function') {\r\n            const handleFnRes = handle.bind(this)(...params)\r\n            validResult = this._valid(handleFnRes)\r\n          } else {\r\n            validResult = this._valid(handle)\r\n          }\r\n        }\r\n        return validResult\r\n      }\r\n    }\r\n\r\n    const validatorsType = Object.prototype.toString.call(validators).slice(8, -1)\r\n\r\n    if (!methods[validatorsType]) {\r\n      throw new Error('Unsupported Validators Type')\r\n    }\r\n\r\n    return methods[validatorsType].bind(this)()\r\n  }\r\n\r\n  // 传入一个新的值，作为需要校验的对象\r\n  format (fnOrVal) {\r\n    this.value = fnOrVal instanceof Function\r\n      ? fnOrVal(this.value)\r\n      : fnOrVal\r\n    return this\r\n  }\r\n  \r\n  // 同步校验\r\n  valid (validators, opts) {\r\n    if (this.pass) return this\r\n    this.pass = !(this.result = this._valid(validators, opts))\r\n    return this\r\n  }\r\n\r\n  // 异步校验\r\n  async validAsync (validators, opts) {\r\n    if (this.pass) return this\r\n    this.pass = !(this.result = this._valid(await validators, opts))\r\n    return this\r\n  }\r\n\r\n  // 获取结果\r\n  // TODO: refactor\r\n  flush () {\r\n    return this.message || this.result\r\n  }\r\n}\r\n\r\n/* 通过 Valy.use 注册插件 */\r\n\r\nconst fns = []\r\nValy.use = models => {\r\n  const fnsMap = new Map(Object.entries(models))\r\n  fns.unshift(fnsMap)\r\n}\r\n// TODO 有没有必要加入 Valy.destory 注销某个插件这种功能\r\n\r\nValy.use(defaultValidator)\r\n\r\nexport default Valy"],"names":[],"mappings":"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"}