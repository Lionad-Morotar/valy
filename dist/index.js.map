{"version":3,"file":"index.js","sources":["../src/insideValidator.js","../src/index.js"],"sourcesContent":["// import utils from './utils'\r\n\r\nexport default {\r\n\r\n  /** social media */\r\n\r\n  email: /^([A-Za-z0-9_.])+@([A-Za-z0-9_])+.([A-Za-z]{2,6})$/,\r\n  mobile: /^((13[0-9])|(14[5|7])|(15([0-3]|[5-9]))|(18[0,5-9]))\\d{8}$/,\r\n  idcard: /^[1-9]\\d{5}(18|19|([23]\\d))\\d{2}((0[1-9])|(10|11|12))(([0-2][1-9])|10|20|30|31)\\d{3}[0-9Xx]$/,\r\n\r\n  // /** number */\r\n\r\n  interger: /^-?\\d+$/,\r\n  float: /^-?\\d*.\\d*$/,\r\n  number: 'interger||float',\r\n  notNaN () {\r\n    return !Number.isNaN(+this.value)\r\n  },\r\n  max (max) {\r\n    return ['notNaN', +this.value < max]\r\n  },\r\n  min (min) {\r\n    return ['notNaN', +this.value > min]\r\n  },\r\n\r\n  /** general */\r\n\r\n  required: /.+/,\r\n  is (_) { return this.value === _ },\r\n  not (_) { return this.value !== _ }\r\n}","import insideValidator from './insideValidator.js'\r\n\r\nconst DEFAULT_VALID_OPTIONS = { stragedy: 'and' }\r\n\r\n/** Valy\r\n * @description Valy校验器, 可以使用两种方式调用:\r\n *  1. new Valy('a1111', 'username').result\r\n *  2. new Valy('a1111').valid(['username', _ => _.length === 5]).check()\r\n * @param {Any} rawValue 待校验的值\r\n * @param {Array, Regex, Function} validItems 待校验的选项\r\n */\r\nclass Valy {\r\n  constructor (rawValue = '', validItems = []) {\r\n    Object.assign(this, {\r\n      pass: false,\r\n      result: null,\r\n      errorMsg: null,\r\n      rawValue,\r\n      value: rawValue,\r\n      validItems\r\n    })\r\n    return new Proxy(this, {\r\n      get: (target, key, receiver) => {\r\n        // TODO prototype properties\r\n        const findMap = maps.find(x => x.has(key))\r\n        return !findMap\r\n          ? Reflect.get(target, key, receiver)\r\n          : (params = {}) => {\r\n            const handle = findMap.get(key)\r\n            this.valid(\r\n              handle.bind\r\n                ? handle.bind(this, params)\r\n                : handle\r\n            )\r\n            return receiver\r\n          }\r\n      }\r\n    })\r\n  }\r\n\r\n  // TODO async validate\r\n  toValid (validItems = this.rawValidItems, options) {\r\n    /** default value */\r\n\r\n    options = Object.assign(DEFAULT_VALID_OPTIONS, options)\r\n\r\n    /** const */\r\n\r\n    const methods = {\r\n      'function': () => {\r\n        const fnResult = validItems(this.value)\r\n        return ['function', 'object'].includes(typeof fnResult)\r\n          ? this.toValid(fnResult)\r\n          : fnResult\r\n      },\r\n      'array': () => {\r\n        const results = validItems.map(x => this.toValid(x))\r\n        return options.stragedy === 'and'\r\n          ? results.every(x => x === true)\r\n          : results.some(x => x === true)\r\n      },\r\n      'regexp': () => validItems.test(this.value),\r\n      'boolean': () => validItems,\r\n      'undefined': () => false,\r\n      'error': () => { throw new Error(`unsupported type of validItem : ${typeof validItems} - ${validItems}`) }\r\n    }\r\n\r\n    /** vars */\r\n\r\n    let toValidResult = null\r\n    switch (typeof validItems) {\r\n      case 'object':\r\n        if (Array.isArray(validItems)) {\r\n          toValidResult = methods['array'].bind(this)()\r\n        } else if (validItems instanceof RegExp) {\r\n          toValidResult = methods['regexp'].bind(this)()\r\n        }\r\n        break\r\n\r\n      case 'string':\r\n        // TODO eval((1&&1||2)||0)\r\n        const validArr = validItems.split('||')\r\n        if (validArr.length > 1) {\r\n          toValidResult = this.toValid(validArr, Object.assign(options, { stragedy: 'or' }))\r\n        } else {\r\n          const toFindHandle = validItems.split('?')\r\n          const [fnName, params] = [toFindHandle[0], (toFindHandle[1] || '').split(',')]\r\n          const handle = maps.find(x => x.has(fnName)).get(fnName)\r\n          if (!handle) {\r\n            toValidResult = false\r\n            this.errorMsg = validItems\r\n            break\r\n          }\r\n          if (typeof handle === 'function') {\r\n            const handleFnRes = handle.bind({ value: this.value })(...params)\r\n            toValidResult = this.toValid(handleFnRes)\r\n          } else {\r\n            toValidResult = this.toValid(handle)\r\n          }\r\n        }\r\n        break\r\n\r\n      default:\r\n        toValidResult = methods[typeof validItems].bind(this)()\r\n    }\r\n\r\n    return toValidResult\r\n  }\r\n  valid (validItems) {\r\n    if (this.pass) return this\r\n    if (!(this.result = this.toValid(validItems))) {\r\n      this.pass = true\r\n    }\r\n    return this\r\n  }\r\n  format (fn = _ => _) {\r\n    this.value = fn(this.value)\r\n    return this\r\n  }\r\n  flush (key) {\r\n    return key\r\n      ? this[key]\r\n      : this.errorMsg || this.result\r\n  }\r\n}\r\n\r\nconst maps = []\r\nValy.use = models => maps.unshift(new Map(Object.entries(models)))\r\nValy.use(insideValidator)\r\n\r\nexport default Valy"],"names":["max","min","const","this"],"mappings":"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"}