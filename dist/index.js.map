{"version":3,"file":"index.js","sources":["../src/insideValidator.js","../src/index.js"],"sourcesContent":["// import utils from './utils'\r\n\r\nexport default {\r\n\r\n  /** social media */\r\n\r\n  email: /^([A-Za-z0-9_.])+@([A-Za-z0-9_])+.([A-Za-z]{2,6})$/,\r\n  mobile: /^((13[0-9])|(14[5|7])|(15([0-3]|[5-9]))|(18[0,5-9]))\\d{8}$/,\r\n  idcard: /^[1-9]\\d{5}(18|19|([23]\\d))\\d{2}((0[1-9])|(10|11|12))(([0-2][1-9])|10|20|30|31)\\d{3}[0-9Xx]$/,\r\n\r\n  /** number */\r\n\r\n  interger: /^-?\\d+$/,\r\n  float: /^-?\\d*.\\d*$/,\r\n  number: 'interger||float',\r\n  notNaN () {\r\n    return !Number.isNaN(+this.value)\r\n  },\r\n  max (max) {\r\n    return ['notNaN', +this.value < max]\r\n  },\r\n  min (min) {\r\n    return ['notNaN', +this.value > min]\r\n  },\r\n\r\n  /** TODO array */\r\n\r\n  /** general */\r\n\r\n  required: /.+/,\r\n  is (_) { return this.value === _ },\r\n  not (_) { return this.value !== _ }\r\n}","import insideValidator from './insideValidator.js'\r\n\r\nconst DEFAULT_VALID_OPTIONS = { stragedy: 'and' }\r\n\r\n/** Valy\r\n * @param {Any} value 待校验的值\r\n */\r\nclass Valy {\r\n  constructor (value = '') {\r\n    Object.assign(this, {\r\n      pass: false,\r\n      result: null,\r\n      message: '',\r\n      value\r\n    })\r\n    return new Proxy(this, {\r\n      get: (target, key, receiver) => {\r\n        // TODO prototype properties\r\n        const findMap = maps.find(x => x.has(key))\r\n        return !findMap\r\n          ? Reflect.get(target, key, receiver)\r\n          : (params = {}) => {\r\n            const handle = findMap.get(key)\r\n            this.valid(\r\n              handle.bind\r\n                ? handle.bind(this, params)\r\n                : handle\r\n            )\r\n            return receiver\r\n          }\r\n      }\r\n    })\r\n  }\r\n\r\n  toValid (validators = [], options) {\r\n    options = Object.assign(DEFAULT_VALID_OPTIONS, options)\r\n\r\n    /** const */\r\n\r\n    const methods = {\r\n      'function': () => {\r\n        const fnResult = validators(this.value)\r\n        return ['function', 'object'].includes(typeof fnResult)\r\n          ? this.toValid(fnResult)\r\n          : fnResult\r\n      },\r\n      'array': () => {\r\n        const results = validators.map(x => this.toValid(x))\r\n        return options.stragedy === 'and'\r\n          ? results.every(x => x === true)\r\n          : results.some(x => x === true)\r\n      },\r\n      'regexp': () => validators.test(this.value),\r\n      'boolean': () => validators,\r\n      'undefined': () => false,\r\n      'error': () => { throw new Error(`unsupported type of validItem : ${typeof validators} - ${validators}`) }\r\n    }\r\n\r\n    /** vars */\r\n\r\n    let toValidResult = null\r\n    switch (typeof validators) {\r\n      case 'object':\r\n        if (Array.isArray(validators)) {\r\n          toValidResult = methods['array'].bind(this)()\r\n        } else if (validators instanceof RegExp) {\r\n          toValidResult = methods['regexp'].bind(this)()\r\n        }\r\n        break\r\n\r\n      case 'string':\r\n        // TODO eval((1&&1||2)||0)\r\n        const validArr = validators.split('||')\r\n        if (validArr.length > 1) {\r\n          toValidResult = this.toValid(validArr, Object.assign(options, { stragedy: 'or' }))\r\n        } else {\r\n          const toFindHandle = validators.split('?')\r\n          const [fnName, params] = [toFindHandle[0], (toFindHandle[1] || '').split(',')]\r\n          const handle = maps.find(x => x.has(fnName)).get(fnName)\r\n          if (!handle) {\r\n            toValidResult = false\r\n            this.message = validators\r\n            break\r\n          }\r\n          if (typeof handle === 'function') {\r\n            const handleFnRes = handle.bind(this)(...params)\r\n            toValidResult = this.toValid(handleFnRes)\r\n          } else {\r\n            toValidResult = this.toValid(handle)\r\n          }\r\n        }\r\n        break\r\n\r\n      default:\r\n        toValidResult = methods[typeof validators].bind(this)()\r\n    }\r\n\r\n    return toValidResult\r\n  }\r\n  format (fn = _ => _) {\r\n    this.value = fn(this.value)\r\n    return this\r\n  }\r\n  valid (validators) {\r\n    if (this.pass) return this\r\n    if (!(this.result = this.toValid(validators))) {\r\n      this.pass = true\r\n    }\r\n    return this\r\n  }\r\n  async validAsync (validators) {\r\n    if (this.pass) return this\r\n    if (!(this.result = this.toValid(await validators))) {\r\n      this.pass = true\r\n    }\r\n    return this\r\n  }\r\n  msg (info) {\r\n    this.result = this.result || info\r\n    return this\r\n  }\r\n  flush (key) {\r\n    return key\r\n      ? this[key]\r\n      : this.message || this.result\r\n  }\r\n}\r\n\r\nconst maps = []\r\nValy.use = models => maps.unshift(new Map(Object.entries(models)))\r\nValy.use(insideValidator)\r\n\r\nexport default Valy"],"names":[],"mappings":"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"}